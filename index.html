<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta name=monetization content=$ilp.uphold.com/2kD7NjJBDjBb><style>body{margin:0;text-align:center;background:#000}body,canvas{touch-action:none;user-select:none}</style><canvas id=c></canvas><script>(()=>{var e={},t=t=>e[t]||0,a=t=>delete e[t];addEventListener("keydown",(t=>{t.preventDefault(),t.repeat||(e[t.code]=performance.now())})),addEventListener("keyup",(e=>a(e.code)));var i=(...e)=>Math.max(...e.map((e=>t(e)))),n=()=>Object.keys(e).filter((e=>t(e))),r=()=>n().length,o=e=>!!t(e)&&a(e),h=Math.random,l=(e,t,a)=>Math.max(t,Math.min(e,a));function s(e,t,a){return 0>a?e:a>1?t:e*(1-a)+t*a}function d(e){return new Promise((t=>{var a=new Image;a.onload=()=>{t(a)},a.src=e}))}var w=0,m=0,g=0,y=0,x=0,f=0,u=0,v=0,p=0,A={pageX:0,pageY:0};addEventListener("pointerdown",(e=>{e.preventDefault(),A=e,p=performance.now(),[w,m]=[u,v]=[x,f]=k()})),addEventListener("pointermove",(e=>{e.preventDefault(),A=e,[w,m]=k(),p&&(w>u?g=s(0,1,((u=w)-x)/30):x>w?g=-s(0,1,(u-(x=w))/30):u>w&&g>=0?(x=w,g=0):w>x&&0>=g&&(u=w,g=0),m>v?y=s(0,1,((v=m)-f)/30):f>m?y=-s(0,1,(v-(f=m))/30):v>m&&y>=0?(f=m,y=0):m>f&&0>=y&&(v=m,y=0))})),addEventListener("pointerup",(e=>{e.preventDefault(),A=e,p=0,g=y=x=f=u=v=0}));var I,M,b,k=()=>[Math.floor(A.pageX),Math.floor(A.pageY)],T=()=>p,X=()=>!!T()&&(p=0,!0),R=(navigator,song={songData:[{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,0,51,2,1,2,25,98,183,32,88,6,157,2],p:[1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[147],f:[,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,6]}]},{i:[0,0,140,0,0,0,140,0,0,255,0,40,95,0,0,0,0,51,2,1,2,20,102,127,80,88,1,88,5],p:[1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,33,15,10,32,0,0,99,1],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[0,221,128,64,0,210,128,0,64,255,4,6,73,79,0,0,0,64,7,1,3,38,15,86,100,20,0,24,3],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,0,40,29,0,0,0,0,195,4,1,3,5,184,119,214,147,6,44,6],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[99,,99,,99,99,,,99,,,,99,,99,,99,99,,,105,,,105,,105,105,,105,105,,105],f:[]}]},{i:[3,146,140,0,1,224,128,3,0,0,0,27,43,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[,,1,2,1,2,,,1,2,2],c:[{n:[111,,,,,,,,,,,,,,,,105],f:[]},{n:[99,,,,,,,,,,,,106,,,,105],f:[]}]}],rowLen:5088,patternLen:32,endPattern:12,numChannels:6}),D=CPlayer=function(){var e,t,a,i,n,r=e=>Math.sin(6.283184*e),o=e=>.003959503758*2**((e-128)/12),h=(e,t,a)=>{var i,n,r,h,s,d,c=l[e.i[0]],w=e.i[1],m=e.i[3]/32,g=l[e.i[4]],y=e.i[5],x=e.i[8]/32,f=e.i[9],u=e.i[10]*e.i[10]*4,v=e.i[11]*e.i[11]*4,p=e.i[12]*e.i[12]*4,A=1/p,I=-e.i[13]/16,M=e.i[14],b=a*2**(2-e.i[15]),k=new Int32Array(u+v+p),T=0,X=0;for(i=0,n=0;u+v+p>i;i++,n++)0>n||(n-=b,s=o(t+(15&(M=M>>8|(255&M)<<4))+e.i[2]-128),d=o(t+(15&M)+e.i[6]-128)*(1+8e-4*e.i[7])),r=1,u>i?r=i/u:u+v>i||(r=(1-(r=(i-u-v)*A))*3**(I*r)),h=c(T+=s*r**m)*w,h+=g(X+=d*r**x)*y,f&&(h+=(2*Math.random()-1)*f),k[i]=80*h*r|0;return k},l=[r,e=>.5>e%1?1:-1,e=>e%1*2-1,e=>{var t=e%1*4;return 2>t?t-1:3-t}];this.init=r=>{e=r,a=0,i=r.rowLen*r.patternLen*((t=r.endPattern)+1)*2,n=new Int32Array(i)},this.generate=()=>{var o,s,d,c,w,m,g,y,x,f,u,v,p,A,I=new Int32Array(i),M=e.songData[a],b=e.rowLen,k=e.patternLen,T=0,X=0,R=!1,D=[];for(d=0;t>=d;++d)for(g=M.p[d],c=0;k>c;++c){var L=g?M.c[g-1].f[c]:0;L&&(M.i[L-1]=M.c[g-1].f[c+k]||0,17>L&&(D=[]));var Y=l[M.i[16]],B=M.i[17]/512,P=2**(M.i[18]-9)/b,E=M.i[19],z=M.i[20],j=135.82764118168*M.i[21]/44100,Q=1-M.i[22]/255,S=1e-5*M.i[23],N=M.i[24]/32,F=M.i[25]/512,J=6.283184*2**(M.i[26]-9)/b,Z=M.i[27]/255,C=M.i[28]*b&-2;for(u=(d*k+c)*b,w=0;4>w;++w)if(m=g?M.c[g-1].n[c+w*k]:0){D[m]||(D[m]=h(M,m,b));var H=D[m];for(s=0,o=2*u;H.length>s;s++,o+=2)I[o]+=H[s]}for(s=0;b>s;s++)(f=I[y=2*(u+s)])||R?(v=j,E&&(v*=Y(P*y)*B+.5),X+=(v=1.5*Math.sin(v))*(p=Q*(f-X)-(T+=v*X)),f=3==z?X:1==z?p:T,S&&(f=1>(f*=S)?f>-1?r(.25*f):-1:1,f/=S),R=(f*=N)*f>1e-5,A=f*(1-(x=Math.sin(J*y)*F+.5)),f*=x):A=0,C>y||(A+=I[y-C+1]*Z,f+=I[y-C]*Z),I[y]=0|A,I[y+1]=0|f,n[y]+=0|A,n[y+1]+=0|f}return++a/e.numChannels},this.createAudioBuffer=e=>{for(var t=e.createBuffer(2,i/2,44100),a=0;2>a;a++)for(var r=t.getChannelData(a),o=a;i>o;o+=2)r[o>>1]=n[o]/65536;return t},this.createWave=()=>{var e=44+2*i-8,t=e-36,a=new Uint8Array(44+2*i);a.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var r=0,o=44;i>r;++r){var h=n[r];a[o++]=255&(h=-32767>h?-32767:h>32767?32767:h),a[o++]=h>>8&255}return a},this.getData=(e,t)=>{for(var a=2*Math.floor(44100*e),i=Array(t),r=0;2*t>r;r+=1){var o=a+r;i[r]=e>0&&n.length>o?n[o]/32768:0}return i}},L={play(){}},Y=()=>{L.play()},B=()=>{L.pause()};function P(e,t,a,i=0,n=1){const r=5*n,o=e.length*r+(e.length-1)*n,h=2===i?o:1===i?o/2:0;[...e].forEach(((e,i)=>{b.drawImage(I,5*"abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/#[]UDLR?'=".indexOf(e),0,5,5,t+i*n*6-h,a,r,r)}))}var E,z,j,Q,S,N,F=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","KeyB","KeyA"],J=0,Z=0,C=["scout","tank"],H=0,G=0,V=240,W=180,U=c.getContext("2d"),O=c.cloneNode(),K=O.getContext("2d");O.width=640,O.height=480;var q=c.cloneNode(),$=q.getContext("2d");q.width=640,q.height=480;var ee,te,ae,ie,ne,re,oe,he,[le,se]=(ee=c,(M=ee.cloneNode()).width=240,M.height=180,(b=M.getContext("2d")).imageSmoothingEnabled=!1,[M,b]),de="#e6d6c2",ce="#1c467a",we={hero:{attackRate:.1,hitPoints:100,speed:75,w:16,h:16,idle:{x:0,y:48,w:16,h:16},torso_forward:{x:16,y:48,w:16,h:9},torso_backward:{x:32,y:48,w:16,h:9},frameIndex1:0,frameIndex1Time:0,legs:[{x:16,y:57,w:16,h:7},{x:32,y:57,w:16,h:7},{x:48,y:57,w:16,h:7},{x:64,y:57,w:16,h:7}],gun:{x:48,y:48,w:11,h:7},frameIndex2:0,frameIndex2Time:0,muzzle_flash:[{x:64,y:48,w:6,h:8},{x:71,y:48,w:5,h:8},{x:77,y:48,w:3,h:8}]},AI:{angle:0,hitPoints:10,speed:Math.PI,w:8,h:8,sprite:{x:96,y:112,w:8,h:8},health:[{x:112,y:96,w:16,h:16},{x:96,y:96,w:16,h:16},{x:80,y:96,w:16,h:16},{x:112,y:80,w:16,h:16},{x:96,y:80,w:16,h:16},{x:80,y:80,w:16,h:16},{x:112,y:64,w:16,h:16},{x:96,y:64,w:16,h:16},{x:80,y:64,w:16,h:16},{x:80,y:112,w:16,h:16},{x:112,y:112,w:16,h:16}]},bullet:{damage:1,speed:400,ttl:1/0,w:1,h:10},blast:{speed:400,maxRadius:200,w:20},scout:{damage:2,hitPoints:1,speed:110,w:16,h:10,hit:{x:128,y:38,w:16,h:10},blood:{x:32,y:112,w:16,h:10},frameIndex1:0,frameIndex1Time:0,bite:[{x:0,y:38,w:16,h:10},{x:16,y:38,w:16,h:10}],frameIndex2:0,frameIndex2Time:0,walk:[{x:32,y:38,w:16,h:10},{x:48,y:38,w:16,h:10},{x:64,y:38,w:16,h:10}]},tank:{damage:10,hitPoints:10,speed:45,w:32,h:32,hit:{x:128,y:0,w:32,h:32},blood:{x:48,y:96,w:32,h:32},frameIndex1:0,frameIndex1Time:0,bite:[{x:0,y:0,w:32,h:32},{x:32,y:0,w:32,h:32}],frameIndex2:0,frameIndex2Time:0,walk:[{x:64,y:0,w:32,h:32},{x:96,y:0,w:32,h:32},{x:96,y:32,w:32,h:32}]},ingress:{odds:{tank:.15,scout:.85},rate:1,spawnTime:0}},me={9:"s.h.e.i.l.d. protocol activated!",8:"hey, that was weird...",7:"did you feel that too?",6:"outch, that really hurt!",5:"whats... what's happening to me?",4:"i'm scared!",3:"i don't feel so good...",2:"am i going to die?",1:"please, don't leave me!",0:"[segfault] access violation"},ge=.1,ye=!0;function xe(e){X(),n().forEach(o),Z=e}function fe(e,t){const a={left:e.x-(t.x+t.w),right:e.x+e.w-t.x,top:e.y-(t.y+t.h),bottom:e.y+e.h-t.y,entity1MaxX:e.x+e.w,entity1MaxY:e.y+e.h,entity2MaxX:t.x+t.w,entity2MaxY:t.y+t.h};return a.collide=0>a.left&&a.right>0&&0>a.top&&a.bottom>0,a}function ue(e,t,a,i){const n=Math.sqrt(Math.pow(a-e,2)+Math.pow(i-t,2)),r=a-e,o=i-t;return[r/n,o/n,Math.atan2(o/n,r/n)]}function ve(e,t=0,a=0){return{...we[e],moveDown:0,moveLeft:0,moveRight:0,moveUp:0,velX:0,velY:0,type:e,x:t,y:a}}function pe(e){if(ie>e.spawnTime){let t=0;Object.entries(e.odds).find((([a,i])=>{if(t+=i,((e=0,t=1)=>h()*(t+1-e)+e)()<t)return S.push(ve(a,e.x,e.y)),e.spawnTime=ie+e.rate,!0}))}}function Ae(e){if(e.velX||e.velY){const t=e.speed*ne*(e.velX&&e.velY?.7071067811865476:1);e.x+=t*e.velX,e.y+=t*e.velY}e.maxRadius&&(e.radius+=e.speed*ne),e===z&&(e.angle+=e.speed*ne,e.angle%=2*Math.PI)}function Ie(e){if(e.hitPoints>0){const t=e.x+e.w/2,a=e.y+e.h/2,i=E.x+E.w/2,n=E.y+E.h/2;[e.velX,e.velY,_]=ue(t,a,i,n)}else e.velX=e.velY=0}function Me(e){switch(ie>e.invincibleEndTime&&(e.invincible=!1,e.hitPoints>0||(e.ttl=-1,e===E&&(E.ded=!0,he=ie+1e3),C.includes(e.type)&&(e=>{const t=we[e.type].blood;$.drawImage(te,t.x,t.y,t.w,t.h,Math.round(e.x),Math.round(e.y),t.w,t.h)})(e))),e.radius>e.maxRadius&&(e.ttl=-1,Q=0),e!==z||z.hitPoints>0||(e.ttl=-1),e.type){case"hero":E.movingRight=E.velX>=0,E.aimingRight=E.gunAngle>-Math.PI/2&&Math.PI/2>E.gunAngle,E.movingForward=E.aimingRight&&E.movingRight||!E.aimingRight&&!E.movingRight,e.frameIndex1Time+=ne,e.frameIndex2Time+=ne,e.frameIndex1Time>ge&&(e.frameIndex1Time-=ge,e.frameIndex1+=E.movingForward?1:-1,e.frameIndex1+=we.hero.legs.length,e.frameIndex1%=we.hero.legs.length),e.frameIndex2Time>ge&&(e.frameIndex2Time-=ge,e.frameIndex2+=1,e.frameIndex2%=we.hero.muzzle_flash.length);break;case"scout":case"tank":e.movingRight=e.velX>=0,e.frameIndex1Time+=ne,e.frameIndex2Time+=ne,e.frameIndex1Time>ge&&(e.frameIndex1Time-=ge,e.frameIndex1+=1,e.frameIndex1%=we.tank.bite.length),e.frameIndex2Time>ge&&(e.frameIndex2Time-=ge,e.frameIndex2+=1,e.frameIndex2%=we.tank.walk.length)}}function be(){const e=E.aimingRight?te:ae;if(K.save(),K.translate(E.w/2,E.h/2),K.rotate(E.gunAngle),K.translate(E.w/4,0),K.drawImage(e,we.hero.gun.x,we.hero.gun.y,we.hero.gun.w,we.hero.gun.h,0,E.aimingRight?-2:-4,we.hero.gun.w,we.hero.gun.h),K.translate(we.hero.gun.w,2),E.attacking){const t=we.hero.muzzle_flash[E.frameIndex2];K.drawImage(e,t.x,t.y,t.w,t.h,-1,E.aimingRight?-6:-5,t.w,t.h)}K.restore()}function ke(){const e=E.aimingRight?te:ae;if(E.velX||E.velY){const t=we.hero[E.movingForward?"torso_forward":"torso_backward"];K.drawImage(e,t.x,t.y,t.w,t.h,0,0,t.w,t.h);const a=we.hero.legs[E.frameIndex1];K.drawImage(e,a.x,a.y,a.w,a.h,0,t.h,a.w,a.h)}else K.drawImage(e,we.hero.idle.x,we.hero.idle.y,we.hero.idle.w,we.hero.idle.h,0,0,we.hero.idle.w,we.hero.idle.h)}function Te(){ye&&(oe=requestAnimationFrame(Te),ie=performance.now(),ne=(ie-re)/1e3,(()=>{switch(Z){case 0:o(F[J])&&J++,(r()||X())&&xe(1);break;case 1:(r()||X())&&((e=>{h=(e=>{for(var t=0,a=2166136261;e.length>t;t++)a=Math.imul(a^e.charCodeAt(t),16777619);a+=a<<13,a^=a>>>7,a+=a<<3,a^=a>>>17;let i=(a+=a<<5)>>>0,n=()=>(2**31-1&(i=Math.imul(48271,i)))/2**31;return n(),n})(e);const t=new URL(location);t.searchParams.set("seed",e),history.pushState({},"",t)})("js13k2022"),J=0,H=G=0,E=ve("hero",120,90),z={type:"AI",...we.AI},N=!0,j={x:0,y:0},Q=0,S=[E,z,{type:"ingress",x:0,y:90,...we.ingress}],he=0,$.fillStyle=de,$.fillRect(0,0,q.width,q.height),Y(),xe(2));break;case 2:if(ie>he){if(E.ded)return B(),void xe(3);[j.x,j.y]=(()=>{const[e,t]=(a=c.width,i=c.height,[l((A.x||A.pageX)-(innerWidth-a)/2,0,a),l(A.y||A.pageY,0,i)].map(Math.round));var a,i;return[e*V/c.width+H,t*W/c.height+G].map(Math.round)})(),E.attacking=T(),E.moveLeft=i("ArrowLeft","KeyA","KeyQ"),E.moveRight=i("ArrowRight","KeyD"),E.moveUp=i("ArrowUp","KeyW","KeyZ"),E.moveDown=i("ArrowDown","KeyS"),E.velX=E.moveLeft||E.moveRight?(E.moveLeft>E.moveRight?-1:1)*s(0,1,(ie-Math.max(E.moveLeft,E.moveRight))/150):0,E.velY=E.moveDown||E.moveUp?(E.moveUp>E.moveDown?-1:1)*s(0,1,(ie-Math.max(E.moveUp,E.moveDown))/150):0,(()=>{const e=E.x+E.w/2,t=E.y+E.h/2,[a,i,n]=ue(e,t,j.x,j.y);if(E.gunAngle=n,E.attacking){if(E.attackTime||=E.attackRate,E.attackTime+=ne,E.attackTime>E.attackRate){E.attackTime%=E.attackRate;const[r,o]=((e,t,a,i)=>[e+a*Math.cos(i),t+a*Math.sin(i)])(e,t,E.w,n);S.unshift({...ve("bullet",r,o),angle:n,velX:a,velY:i})}}else E.attackTime=0})(),ingresses=S.filter((e=>"ingress"===e.type)),ingresses.forEach(pe),S.forEach(Ae),enemies=S.filter((e=>C.includes(e.type))),enemies.forEach(Ie),bullets=S.filter((e=>"bullet"===e.type)),t=bullets,a=enemies,t.forEach((e=>{e.ttl>0&&a.find((t=>{if(!t.invincible&&fe(e,t).collide)return t.hitPoints-=e.damage,t.invincible=!0,t.invincibleEndTime=ie+250,e.ttl=-1,!0}))})),Q&&enemies.forEach((e=>{Q.radius>Math.sqrt(Math.pow(e.x+e.w/2-Q.x,2)+Math.pow(e.y+e.h/2-Q.y,2))&&(e.hitPoints=0,e.invincible||=!0,e.invincibleEndTime||=ie+250)})),(e=>{E.invincible||e.find((e=>{if(e.hitPoints>0&&fe(e,E).collide)return e.attacking=!0,N&&z.hitPoints>0?(z.hitPoints-=1,(S=S.filter((e=>"text"!==e.type))).push({align:void 0,scale:void 0,startTime:ie,text:me[z.hitPoints],ttl:ie+5e3,type:"text",x:4*z.w+5,y:10})):E.hitPoints-=e.damage,E.invincible=!0,E.invincibleEndTime=ie+250,he=ie+75,!Q&&z.hitPoints>0&&(Q={type:"blast",...we.blast,radius:E.w,x:E.x+E.w/2,y:E.y+E.h/2},S.unshift(Q)),!0}))})(enemies);const n=[...enemies,E];n.forEach(((e,t)=>{n.slice(t+1).forEach((t=>{const a=fe(e,t);a.collide&&((e,t,a)=>{const{entity1MaxX:i,entity1MaxY:n,entity2MaxX:r,entity2MaxY:o}=a,h=i-t.x,l=n-t.y,s=r-e.x,d=o-e.y;e.velX>0&&e.velY>0?l>h?(e.x-=h/2,t.x+=h/2):(e.y-=l/2,t.y+=l/2):e.velX>0&&0>e.velY?d>h?(e.x-=h/2,t.x+=h/2):(e.y+=d/2,t.y-=d/2):e.velX>0?(e.x-=h/2,t.x+=h/2):0>e.velX&&e.velY>0?l>s?(e.x+=s/2,t.x-=s/2):(e.y-=l/2,t.y+=l/2):0>e.velX&&0>e.velY?d>s?(e.x+=s/2,t.x-=s/2):(e.y+=d/2,t.y-=d/2):0>e.velX?(e.x+=s/2,t.x-=s/2):e.velY>0?(e.y-=l/2,t.y+=l/2):0>e.velY&&(e.y+=d/2,t.y-=d/2)})(e,t,a)}))})),0>(e=E).x?e.x=0:e.x>q.width-e.w&&(e.x=q.width-e.w),0>e.y?e.y=0:e.y>q.height-e.h&&(e.y=q.height-e.h),S.forEach(Me),H>0&&H+50>E.x?H=Math.max(0,E.x-50):q.width>H+50+140&&E.x+E.w>H+50+140&&(H=Math.min(q.width-V,E.x+E.w-190)),G>0&&G+20>E.y?G=Math.max(0,E.y-20):q.height>G+20+140&&E.y+E.h>G+20+140&&(G=Math.min(q.height-W,E.y+E.h-160)),S=S.filter((e=>!e.ttl||e.ttl>ie))}break;case 3:o("KeyT")&&(async e=>{if(navigator.canShare&&navigator.canShare(e))try{await navigator.share(e)}catch{}else open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(e.text)}&url=${encodeURIComponent(e.url)}`,"_blank")})({title:document.title,text:"I died facing fearful odds playing Stand By Me made by @herebefrogs for #js13k 2022",url:"https://bit.ly/3eBOQS6"}),(r()||X())&&xe(0)}var e,t,a})(),(()=>{let e;switch(b.clearRect(0,0,M.width,M.height),Z){case 0:K.fillStyle=de,K.fillRect(0,0,O.width,O.height),e=we.AI.health[10],se.drawImage(te,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),P("stand by me",120,50,1,3),P("click / press any key",120,105,1),P("proudly made in canada",120,150,1),P("jerome lecomte - js13kgames 2022",120,160,1),P("music by ryan malm",120,170,1);break;case 1:K.fillStyle=de,K.fillRect(0,0,O.width,O.height),e=we.AI.health[10],se.drawImage(te,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),P("i am your defense module companion!",120,50,1),P("i will stand by your side while",120,60,1),P("you protect the central core",120,70,1),P("from parasite contamination.",120,80,1),P("use wasd/ULDR to move",120,120,1),P("use your mouse to aim/fire",120,130,1),P("press any key to start",120,140,1);break;case 2:K.drawImage(q,0,0,O.width,O.height),S.forEach((e=>((e,t=K)=>{switch(t.save(),e.type){case"hero":t.translate(Math.round(e.x),Math.round(e.y)),0>e.gunAngle?(be(),ke()):(ke(),be());break;case"AI":t.translate(E.x+E.w/2,E.y+E.h/2),t.rotate(e.angle),t.translate(2.5*e.w,0),t.rotate(-e.angle),t.drawImage(te,we.AI.sprite.x,we.AI.sprite.y,we.AI.sprite.w,we.AI.sprite.h,-e.w/2,-e.h/2,we.AI.sprite.w,we.AI.sprite.h);break;case"bullet":t.translate(e.x,e.y),t.rotate(e.angle+Math.PI/2),t.fillStyle="#e1e",t.fillRect(0,0,e.w,e.h);break;case"blast":t.beginPath(),t.lineWidth=e.w,t.arc(e.x,e.y,e.radius-e.w/2,0,2*Math.PI),t.strokeStyle="#1ee",t.stroke(),t.closePath();break;case"scout":case"tank":const a=e.hitPoints>0?we[e.type][e.attacking?"bite":"walk"][e.attacking?e.frameIndex1:e.frameIndex2]:we[e.type].hit;t.drawImage(e.movingRight?te:ae,a.x,a.y,a.w,a.h,Math.round(e.x),Math.round(e.y),a.w,a.h);break;case"text":se.fillStyle=ce,se.fillRect(3*z.w+5,5,V-(3*z.w+10),15),((e,t,a,i,n,r=0,o=1)=>{P(e.substring(0,Math.floor(s(0,e.length,(n-i)/500))),t,a,r,o)})(e.text,e.x,e.y,e.startTime,ie,e.align,e.scale)}t.restore()})(e))),(()=>{K.strokeStyle=ce,K.lineWidth=2;const e=E.attacking?10:12,t=E.attacking?5:6;K.strokeRect(j.x-1,j.y-1,2,2),K.strokeRect(j.x-t,j.y-t,e,e)})(),(()=>{const e=we.AI.health[Math.max(0,z.hitPoints)];se.drawImage(te,e.x,e.y,e.w,e.h,5,5,e.w,e.h)})();break;case 3:K.fillStyle=de,K.fillRect(0,0,O.width,O.height),e=we.AI.health[0],se.drawImage(te,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),P("how can one die better",120,50,1),P("than facing fearful odds",120,60,1),P("for the ashes of their ancestors",120,70,1),P("and the temples of their gods?",120,80,1),P("[t]weet",120,160,1),P("[r]estart",120,170,1)}U.drawImage(O,H,G,V,W,0,0,c.width,c.height),U.drawImage(le,0,0,V,W,0,0,c.width,c.height)})(),re=ie)}function Xe(e){(ye=e)?(re=performance.now(),Te()):cancelAnimationFrame(oe)}onload=async()=>{document.title="Stand By Me",onresize(),await(async()=>{I=await d("data:image/webp;base64,UklGRtwAAABXRUJQVlA4TNAAAAAvCAEBEA8wfQNPIGmLt/3zH+AHlG3bzr+in79tNjP9j1/727ZmW8m2jWovL+4T/FcXF5ltvhH9D/T3glZlee7h4P2XrG7pyXpT+f1vpQBO4GqQKqZMeMBmhJ454slp0xJG5tfl6H5BDR2Xp1JxjD3jmmpGcQ1oui+BiDupttiTmV+nmfJNXI5yzBxoJ3I1FwgJALAZqWdJfcLttBk8/IICn88jn1j3UamwMWfkts/gruDp62NyFZ3LDhkOx83c4p31QzawchYEXAmxQaqY4gIA")})(),te=await d("data:image/webp;base64,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"),ae=await d("data:image/webp;base64,UklGRtwDAABXRUJQVlA4TM8DAAAvn8AfECdAJm1T/8ZKDeyeLIJsmwFNbFiXOwdBts0MZzPAK11g/gOw73emDChGslW3tlRlEtgWCYgiAKlIwOyz8s/pwt5rI/t+3zei/xAlSarbzDmR34wAwfoXtp9hvTDrkx5nm0W1RORQfM7jbDLqIjfIrKL4mMf447dXFieWPuRx7uJuD4vsInuTo8B5GKYH97rhcYove8DVZpEThdViHtcQu1Y93GN+eGVCAe3GN3nYx8HhJZ6jKH38Po9TGFdMMuwiGdaDseoR8pg0wz4ohtYwKk8PzppHiDi+ABgQAsqiR0gLvdX0+wV066mEZY+QKyYxz3d5hDwmX4TCKaHHseQRIt8lmQN+nbzJ49zDN1LMwDKsR73tEXANr8uw4Hl4nssey+BqAXg6Te9R7nq0+KvcPD8cr+I0icfzpscZ8/TDoCiY2Ao9HMTjDpX0m9ZJtZbMg5O4Bwx7uLKB9RswPYx27KFWJA2v4DyjF64t6gikdQ+YJ4DAC1hbKRECjj/UidqOu4MMoJWB2MN0nAVOA5UwRVp4YdbiRsaw4DE7wuE21ullTdKE7NMyt5hx1lVhzrFU3bYFD9MTAy0gMcd4DZNkNsL9mk+2Jrt551CcamkKLHmYA7w1eyJ5hv5MTo/TAYDIxR4eUx4mYzAZzAu8scTVdrN+BpDc+R3QgSzCcufH6Xb3oLnz08CU8Ny5yNuGoBs0L+TOcHa+smha/32QKDopOc6d5y7Xgx/3dmAVSGJf1+3TOc6d5hKn5NZE3VUYkgX26wxiiXPnLiJXAMxDiPS0xSPAvq5n80JEcjwoX5AyyDvErtpIDhG1X9cT+1iQOx0S0I8C04AUYGq7HsfABs0D8PM+Ao7GB1uKDl9MsaqYDejcX155CiQjVhX+uoxzZ/SjzO9q6nc3v8eo29/T5nzE1ULu3CV6M9yqgqjcapO8zyIlmevoTQuua8wP8TLLv5JdM4mKVBAelDB3Lp0/jS9gIoAChJOtu5WjCxivY2C0mEhFNRrtMTek8+HXXZo7FYtk6Qe+oSJZkxdJWUS6XbbOtp1t/GlBFp47tS5T1GJ+eBmRBEHuiT5A0aNAgtyJNdw0H3YHyZlq5yd9S6/PLofmIHfqLVwDdACDL+pFukgZVMrax3weX2XziPQsklms0yXIrnu/gYkYxsFTP0ue9AnuYvr3DQ0IJhCWS9VkqSWAqkED1YBa7D8tdt2VjCwslxYTT5ZImwGuAU0u4JF1RBPLJTSXIm1r1LT56wEGJuQElK5DLJfeWhBfcHPC9CtZKT0IALB9d/W///ytzAYA"),[audio,data]=(()=>{const e=new D;e.init(R);let t=0;for(;1>t;)t=e.generate(),console.log(`loaded ${100*t}%`);let a=e.createWave();return[document.createElement("audio"),URL.createObjectURL(new Blob([a],{type:"audio/wav"}))]})(),(L=audio).src=data,L.loop=!0,L.volume=.15,Xe(!0)},onresize=onrotate=()=>{scaleToFit=Math.min(innerWidth/O.width,innerHeight/O.height),c.width=O.width*scaleToFit,c.height=O.height*scaleToFit,U.imageSmoothingEnabled=$.imageSmoothingEnabled=K.imageSmoothingEnabled=!1,window.focus()},document.onvisibilitychange=e=>{Xe(!e.target.hidden),e.target.hidden?B():Y()},addEventListener("keydown",(e=>{e.repeat||2!==Z||"KeyP"!==e.code||Xe(!ye)}))})();</script>