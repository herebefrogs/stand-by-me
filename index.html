<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta name=monetization content=$ilp.uphold.com/2kD7NjJBDjBb><style>body{margin:0;text-align:center;background:#000}body,canvas{touch-action:none;user-select:none}</style><canvas id=c></canvas><script>(()=>{var e={},t=t=>e[t]||0,a=t=>delete e[t];addEventListener("keydown",(t=>{t.preventDefault(),t.repeat||(e[t.code]=performance.now())})),addEventListener("keyup",(e=>a(e.code)));var i=(...e)=>Math.max(...e.map((e=>t(e)))),n=()=>Object.keys(e).filter((e=>t(e))),r=()=>n().length,h=e=>!!t(e)&&a(e),o=Math.random,l=(e,t,a)=>Math.max(t,Math.min(e,a));function s(e,t,a){return 0>a?e:a>1?t:e*(1-a)+t*a}function d(e){return new Promise((t=>{var a=new Image;a.onload=()=>{t(a)},a.src=e}))}var w=0,m=0,y=0,x=0,g=0,f=0,u=0,v=0,p=0,A={pageX:0,pageY:0};addEventListener("pointerdown",(e=>{e.preventDefault(),A=e,p=performance.now(),[w,m]=[u,v]=[g,f]=M()})),addEventListener("pointermove",(e=>{e.preventDefault(),A=e,[w,m]=M(),p&&(w>u?y=s(0,1,((u=w)-g)/30):g>w?y=-s(0,1,(u-(g=w))/30):u>w&&y>=0?(g=w,y=0):w>g&&0>=y&&(u=w,y=0),m>v?x=s(0,1,((v=m)-f)/30):f>m?x=-s(0,1,(v-(f=m))/30):v>m&&x>=0?(f=m,x=0):m>f&&0>=x&&(v=m,x=0))})),addEventListener("pointerup",(e=>{e.preventDefault(),A=e,p=0,y=x=g=f=u=v=0}));var I,b,k,M=()=>[Math.floor(A.pageX),Math.floor(A.pageY)],T=()=>p,R=()=>!!T()&&(p=0,!0),X=(navigator,song={songData:[{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,0,51,2,1,2,25,98,183,32,88,6,157,2],p:[1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[147],f:[,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,6]}]},{i:[0,0,140,0,0,0,140,0,0,255,0,40,95,0,0,0,0,51,2,1,2,20,102,127,80,88,1,88,5],p:[1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,33,15,10,32,0,0,99,1],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[0,221,128,64,0,210,128,0,64,255,4,6,73,79,0,0,0,64,7,1,3,38,15,86,100,20,0,24,3],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,0,40,29,0,0,0,0,195,4,1,3,5,184,119,214,147,6,44,6],p:[1,1,1,1,1,1,1,1,,,1,1,1],c:[{n:[99,,99,,99,99,,,99,,,,99,,99,,99,99,,,105,,,105,,105,105,,105,105,,105],f:[]}]},{i:[3,146,140,0,1,224,128,3,0,0,0,27,43,0,0,0,3,179,5,1,2,124,135,11,32,150,3,157,6],p:[,,1,2,1,2,,,1,2,2],c:[{n:[111,,,,,,,,,,,,,,,,105],f:[]},{n:[99,,,,,,,,,,,,106,,,,105],f:[]}]}],rowLen:5088,patternLen:32,endPattern:12,numChannels:6}),D=CPlayer=function(){var e,t,a,i,n,r=e=>Math.sin(6.283184*e),h=e=>.003959503758*2**((e-128)/12),o=(e,t,a)=>{var i,n,r,o,s,d,c=l[e.i[0]],w=e.i[1],m=e.i[3]/32,y=l[e.i[4]],x=e.i[5],g=e.i[8]/32,f=e.i[9],u=e.i[10]*e.i[10]*4,v=e.i[11]*e.i[11]*4,p=e.i[12]*e.i[12]*4,A=1/p,I=-e.i[13]/16,b=e.i[14],k=a*2**(2-e.i[15]),M=new Int32Array(u+v+p),T=0,R=0;for(i=0,n=0;u+v+p>i;i++,n++)0>n||(n-=k,s=h(t+(15&(b=b>>8|(255&b)<<4))+e.i[2]-128),d=h(t+(15&b)+e.i[6]-128)*(1+8e-4*e.i[7])),r=1,u>i?r=i/u:u+v>i||(r=(1-(r=(i-u-v)*A))*3**(I*r)),o=c(T+=s*r**m)*w,o+=y(R+=d*r**g)*x,f&&(o+=(2*Math.random()-1)*f),M[i]=80*o*r|0;return M},l=[r,e=>.5>e%1?1:-1,e=>e%1*2-1,e=>{var t=e%1*4;return 2>t?t-1:3-t}];this.init=r=>{e=r,a=0,i=r.rowLen*r.patternLen*((t=r.endPattern)+1)*2,n=new Int32Array(i)},this.generate=()=>{var h,s,d,c,w,m,y,x,g,f,u,v,p,A,I=new Int32Array(i),b=e.songData[a],k=e.rowLen,M=e.patternLen,T=0,R=0,X=!1,D=[];for(d=0;t>=d;++d)for(y=b.p[d],c=0;M>c;++c){var Y=y?b.c[y-1].f[c]:0;Y&&(b.i[Y-1]=b.c[y-1].f[c+M]||0,17>Y&&(D=[]));var L=l[b.i[16]],P=b.i[17]/512,z=2**(b.i[18]-9)/k,E=b.i[19],C=b.i[20],J=135.82764118168*b.i[21]/44100,B=1-b.i[22]/255,K=1e-5*b.i[23],S=b.i[24]/32,H=b.i[25]/512,N=6.283184*2**(b.i[26]-9)/k,Z=b.i[27]/255,Q=b.i[28]*k&-2;for(u=(d*M+c)*k,w=0;4>w;++w)if(m=y?b.c[y-1].n[c+w*M]:0){D[m]||(D[m]=o(b,m,k));var j=D[m];for(s=0,h=2*u;j.length>s;s++,h+=2)I[h]+=j[s]}for(s=0;k>s;s++)(f=I[x=2*(u+s)])||X?(v=J,E&&(v*=L(z*x)*P+.5),R+=(v=1.5*Math.sin(v))*(p=B*(f-R)-(T+=v*R)),f=3==C?R:1==C?p:T,K&&(f=1>(f*=K)?f>-1?r(.25*f):-1:1,f/=K),X=(f*=S)*f>1e-5,A=f*(1-(g=Math.sin(N*x)*H+.5)),f*=g):A=0,Q>x||(A+=I[x-Q+1]*Z,f+=I[x-Q]*Z),I[x]=0|A,I[x+1]=0|f,n[x]+=0|A,n[x+1]+=0|f}return++a/e.numChannels},this.createAudioBuffer=e=>{for(var t=e.createBuffer(2,i/2,44100),a=0;2>a;a++)for(var r=t.getChannelData(a),h=a;i>h;h+=2)r[h>>1]=n[h]/65536;return t},this.createWave=()=>{var e=44+2*i-8,t=e-36,a=new Uint8Array(44+2*i);a.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var r=0,h=44;i>r;++r){var o=n[r];a[h++]=255&(o=-32767>o?-32767:o>32767?32767:o),a[h++]=o>>8&255}return a},this.getData=(e,t)=>{for(var a=2*Math.floor(44100*e),i=Array(t),r=0;2*t>r;r+=1){var h=a+r;i[r]=e>0&&n.length>h?n[h]/32768:0}return i}},Y={play(){}},L=()=>{Y.play()},P=()=>{Y.pause()};function z(e,t,a,i=0,n=1){const r=5*n,h=e.length*r+(e.length-1)*n,o=2===i?h:1===i?h/2:0;[...e].forEach(((e,i)=>{k.drawImage(I,5*"abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/#[]UDLR?'=".indexOf(e),0,5,5,t+i*n*6-o,a,r,r)}))}var E,C,J,B,K,S,H=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","KeyB","KeyA"],N=0,Z=0,Q=["scout","tank"],j=0,F=0,O=240,U=180,q=c.getContext("2d"),G=c.cloneNode(),W=G.getContext("2d");G.width=640,G.height=480;var V=c.cloneNode(),$=V.getContext("2d");V.width=640,V.height=480;var ee,te,ae,ie,ne,re,he,oe,le,[se,de]=(ee=c,(b=ee.cloneNode()).width=240,b.height=180,(k=b.getContext("2d")).imageSmoothingEnabled=!1,[b,k]),ce="#e6d6c2",we="#1c467a",me={hero:{attackRate:.1,hitPoints:100,speed:75,w:16,h:16,idle:{x:0,y:48,w:16,h:16},torso_forward:{x:16,y:48,w:16,h:9},torso_backward:{x:32,y:48,w:16,h:9},frameIndex1:0,frameIndex1Time:0,legs:[{x:16,y:57,w:16,h:7},{x:32,y:57,w:16,h:7},{x:48,y:57,w:16,h:7},{x:64,y:57,w:16,h:7}],gun:{x:48,y:48,w:11,h:7},frameIndex2:0,frameIndex2Time:0,muzzle_flash:[{x:64,y:48,w:6,h:8},{x:71,y:48,w:5,h:8},{x:77,y:48,w:3,h:8}]},AI:{angle:0,hitPoints:10,speed:Math.PI,w:8,h:8,sprite:{x:96,y:112,w:8,h:8},health:[{x:112,y:96,w:16,h:16},{x:96,y:96,w:16,h:16},{x:80,y:96,w:16,h:16},{x:112,y:80,w:16,h:16},{x:96,y:80,w:16,h:16},{x:80,y:80,w:16,h:16},{x:112,y:64,w:16,h:16},{x:96,y:64,w:16,h:16},{x:80,y:64,w:16,h:16},{x:80,y:112,w:16,h:16},{x:112,y:112,w:16,h:16}]},bullet:{damage:1,speed:400,ttl:1/0,w:1,h:10},blast:{speed:400,maxRadius:200,w:20},scout:{damage:2,hitPoints:1,speed:110,w:16,h:10,hit:{x:128,y:38,w:16,h:10},blood:{x:32,y:112,w:16,h:10},frameIndex1:0,frameIndex1Time:0,bite:[{x:0,y:38,w:16,h:10},{x:16,y:38,w:16,h:10}],frameIndex2:0,frameIndex2Time:0,walk:[{x:32,y:38,w:16,h:10},{x:48,y:38,w:16,h:10},{x:64,y:38,w:16,h:10}]},tank:{damage:10,hitPoints:10,speed:45,w:32,h:32,hit:{x:128,y:0,w:32,h:32},blood:{x:48,y:96,w:32,h:32},frameIndex1:0,frameIndex1Time:0,bite:[{x:0,y:0,w:32,h:32},{x:32,y:0,w:32,h:32}],frameIndex2:0,frameIndex2Time:0,walk:[{x:64,y:0,w:32,h:32},{x:96,y:0,w:32,h:32},{x:96,y:32,w:32,h:32}]},ingress:{odds:{tank:.15,scout:.85},rate:1,spawnTime:0},tiles:{0:{x:0,y:112},1:{x:0,y:64},2:{x:16,y:64},3:{x:32,y:64},4:{x:0,y:80},5:{x:16,y:80},6:{x:32,y:80},7:{x:0,y:96},8:{x:16,y:96},9:{x:32,y:96},11:{x:128,y:96},12:{x:144,y:96},13:{x:128,y:112},14:{x:144,y:112}}},ye={9:"s.h.e.i.l.d. protocol activated!",8:"hey, that was weird...",7:"did you feel that too?",6:"outch, that really hurt!",5:"whats... what's happening to me?",4:"i'm scared!",3:"i don't feel so good...",2:"am i going to die?",1:"please, don't leave me!",0:"[segfault] access violation"},xe=.1,ge=!0;function fe(e){R(),n().forEach(h),Z=e}function ue(e,t){const a={left:e.x-(t.x+t.w),right:e.x+e.w-t.x,top:e.y-(t.y+t.h),bottom:e.y+e.h-t.y,entity1MaxX:e.x+e.w,entity1MaxY:e.y+e.h,entity2MaxX:t.x+t.w,entity2MaxY:t.y+t.h};return a.collide=0>a.left&&a.right>0&&0>a.top&&a.bottom>0,a}function ve(e,t,a,i){const n=Math.sqrt(Math.pow(a-e,2)+Math.pow(i-t,2)),r=a-e,h=i-t;return[r/n,h/n,Math.atan2(h/n,r/n)]}function pe(e,t=0,a=0){return{...me[e],moveDown:0,moveLeft:0,moveRight:0,moveUp:0,velX:0,velY:0,type:e,x:t,y:a}}function Ae(e){if(ne>e.spawnTime){let t=0;Object.entries(e.odds).find((([a,i])=>{if(t+=i,((e=0,t=1)=>o()*(t+1-e)+e)()<t)return K.push(pe(a,e.x,e.y)),e.spawnTime=ne+e.rate,!0}))}}function Ie(e){if(e.velX||e.velY){const t=e.speed*re*(e.velX&&e.velY?.7071067811865476:1);e.x+=t*e.velX,e.y+=t*e.velY}e.maxRadius&&(e.radius+=e.speed*re),e===C&&(e.angle+=e.speed*re,e.angle%=2*Math.PI)}function be(e){if(e.hitPoints>0){const t=e.x+e.w/2,a=e.y+e.h/2,i=E.x+E.w/2,n=E.y+E.h/2;[e.velX,e.velY,_]=ve(t,a,i,n)}else e.velX=e.velY=0}function ke(e){switch(ne>e.invincibleEndTime&&(e.invincible=!1,e.hitPoints>0||(e.ttl=-1,e===E&&(E.ded=!0,le=ne+1e3),Q.includes(e.type)&&(e=>{const t=me[e.type].blood;$.drawImage(ae,t.x,t.y,t.w,t.h,Math.round(e.x),Math.round(e.y),t.w,t.h)})(e))),e.radius>e.maxRadius&&(e.ttl=-1,B=0),e!==C||C.hitPoints>0||(e.ttl=-1),e.type){case"hero":E.movingRight=E.velX>=0,E.aimingRight=E.gunAngle>-Math.PI/2&&Math.PI/2>E.gunAngle,E.movingForward=E.aimingRight&&E.movingRight||!E.aimingRight&&!E.movingRight,e.frameIndex1Time+=re,e.frameIndex2Time+=re,e.frameIndex1Time>xe&&(e.frameIndex1Time-=xe,e.frameIndex1+=E.movingForward?1:-1,e.frameIndex1+=me.hero.legs.length,e.frameIndex1%=me.hero.legs.length),e.frameIndex2Time>xe&&(e.frameIndex2Time-=xe,e.frameIndex2+=1,e.frameIndex2%=me.hero.muzzle_flash.length);break;case"scout":case"tank":e.movingRight=e.velX>=0,e.frameIndex1Time+=re,e.frameIndex2Time+=re,e.frameIndex1Time>xe&&(e.frameIndex1Time-=xe,e.frameIndex1+=1,e.frameIndex1%=me.tank.bite.length),e.frameIndex2Time>xe&&(e.frameIndex2Time-=xe,e.frameIndex2+=1,e.frameIndex2%=me.tank.walk.length)}}function Me(){const e=E.aimingRight?ae:ie;if(W.save(),W.translate(E.w/2,E.h/2),W.rotate(E.gunAngle),W.translate(E.w/4,0),W.drawImage(e,me.hero.gun.x,me.hero.gun.y,me.hero.gun.w,me.hero.gun.h,0,E.aimingRight?-2:-4,me.hero.gun.w,me.hero.gun.h),W.translate(me.hero.gun.w,2),E.attacking){const t=me.hero.muzzle_flash[E.frameIndex2];W.drawImage(e,t.x,t.y,t.w,t.h,-1,E.aimingRight?-6:-5,t.w,t.h)}W.restore()}function Te(){const e=E.aimingRight?ae:ie;if(E.velX||E.velY){const t=me.hero[E.movingForward?"torso_forward":"torso_backward"];W.drawImage(e,t.x,t.y,t.w,t.h,0,0,t.w,t.h);const a=me.hero.legs[E.frameIndex1];W.drawImage(e,a.x,a.y,a.w,a.h,0,t.h,a.w,a.h)}else W.drawImage(e,me.hero.idle.x,me.hero.idle.y,me.hero.idle.w,me.hero.idle.h,0,0,me.hero.idle.w,me.hero.idle.h)}function Re(){ge&&(oe=requestAnimationFrame(Re),ne=performance.now(),re=(ne-he)/1e3,(()=>{switch(Z){case 0:h(H[N])&&N++,(r()||R())&&fe(1);break;case 1:(r()||R())&&((e=>{o=(e=>{for(var t=0,a=2166136261;e.length>t;t++)a=Math.imul(a^e.charCodeAt(t),16777619);a+=a<<13,a^=a>>>7,a+=a<<3,a^=a>>>17;let i=(a+=a<<5)>>>0,n=()=>(2**31-1&(i=Math.imul(48271,i)))/2**31;return n(),n})(e);const t=new URL(location);t.searchParams.set("seed",e),history.pushState({},"",t)})("js13k2022"),N=0,j=F=0,E=pe("hero",120,90),C={type:"AI",...me.AI},S=!0,J={x:0,y:0},B=0,K=[E,C,{type:"ingress",x:16,y:90,...me.ingress}],le=0,te=(()=>{let e,t;$.fillStyle=ce,$.fillRect(0,0,V.width,V.height);let a=[{x:-32,y:-32,w:32+V.width+32,h:64},{x:-32,y:V.height-16,w:32+V.width+32,h:48},{x:-32,y:-32,w:48,h:32+V.height+32},{x:V.width-16,y:-32,w:48,h:32+V.height+32}];return"5555555555555555555555555555555555555555B88888888888888888888888888888888888888C6000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000001222300000000000000000000046000000000000455560000000000000000000004600000000000045B8900000000000000000000046000000000000789000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004600000000000000000000000000000000000000460000000000000000000000000000000000000046000000000000000000000000000000000000004D22222222222222222222222222222222222222E".split("").forEach(((i,n)=>{if(e=n%(V.width/16),t=Math.floor(n/(V.width/16)),[1,2,3,4,5,6,7,8,9,11,12,13,14].includes(i=parseInt(i,16))){const n={x:16*e,y:16*t,w:16,h:16};$.drawImage(ae,me.tiles[i].x,me.tiles[i].y,16,16,n.x,n.y,16,16),(0!==e&&e!==V.width/16-1||0!==t&&t!==V.height/16-1)&&a.push(n)}})),a})(),L(),fe(2));break;case 2:if(ne>le){if(E.ded)return P(),void fe(3);[J.x,J.y]=(()=>{const[e,t]=(a=c.width,i=c.height,[l((A.x||A.pageX)-(innerWidth-a)/2,0,a),l(A.y||A.pageY,0,i)].map(Math.round));var a,i;return[e*O/c.width+j,t*U/c.height+F].map(Math.round)})(),E.attacking=T(),E.moveLeft=i("ArrowLeft","KeyA","KeyQ"),E.moveRight=i("ArrowRight","KeyD"),E.moveUp=i("ArrowUp","KeyW","KeyZ"),E.moveDown=i("ArrowDown","KeyS"),E.velX=E.moveLeft||E.moveRight?(E.moveLeft>E.moveRight?-1:1)*s(0,1,(ne-Math.max(E.moveLeft,E.moveRight))/150):0,E.velY=E.moveDown||E.moveUp?(E.moveUp>E.moveDown?-1:1)*s(0,1,(ne-Math.max(E.moveUp,E.moveDown))/150):0,(()=>{const e=E.x+E.w/2,t=E.y+E.h/2,[a,i,n]=ve(e,t,J.x,J.y);if(E.gunAngle=n,E.attacking){if(E.attackTime||=E.attackRate,E.attackTime+=re,E.attackTime>E.attackRate){E.attackTime%=E.attackRate;const[r,h]=((e,t,a,i)=>[e+a*Math.cos(i),t+a*Math.sin(i)])(e,t,E.w,n);K.unshift({...pe("bullet",r,h),angle:n,velX:a,velY:i})}}else E.attackTime=0})(),ingresses=K.filter((e=>"ingress"===e.type)),ingresses.forEach(Ae),K.forEach(Ie),enemies=K.filter((e=>Q.includes(e.type))),enemies.forEach(be),bullets=K.filter((e=>"bullet"===e.type)),t=bullets,a=enemies,t.forEach((e=>{e.ttl>0&&a.find((t=>{if(!t.invincible&&ue(e,t).collide)return t.hitPoints-=e.damage,t.invincible=!0,t.invincibleEndTime=ne+250,e.ttl=-1,!0}))})),B&&enemies.forEach((e=>{B.radius>Math.sqrt(Math.pow(e.x+e.w/2-B.x,2)+Math.pow(e.y+e.h/2-B.y,2))&&(e.hitPoints=0,e.invincible||=!0,e.invincibleEndTime||=ne+250)})),(e=>{E.invincible||e.find((e=>{if(e.hitPoints>0&&ue(e,E).collide)return e.attacking=!0,S&&C.hitPoints>0?(C.hitPoints-=1,(K=K.filter((e=>"text"!==e.type))).push({align:void 0,scale:void 0,startTime:ne,text:ye[C.hitPoints],ttl:ne+5e3,type:"text",x:4*C.w+5,y:10})):E.hitPoints-=e.damage,E.invincible=!0,E.invincibleEndTime=ne+250,le=ne+75,!B&&C.hitPoints>0&&(B={type:"blast",...me.blast,radius:E.w,x:E.x+E.w/2,y:E.y+E.h/2},K.unshift(B)),!0}))})(enemies),(e=[...enemies,E]).forEach(((t,a)=>{e.slice(a+1).forEach((e=>{const a=ue(t,e);a.collide&&((e,t,a)=>{const{entity1MaxX:i,entity1MaxY:n,entity2MaxX:r,entity2MaxY:h}=a,o=i-t.x,l=n-t.y,s=r-e.x,d=h-e.y;e.velX>0&&e.velY>0?l>o?(e.x-=o/2,t.x+=o/2):(e.y-=l/2,t.y+=l/2):e.velX>0&&0>e.velY?d>o?(e.x-=o/2,t.x+=o/2):(e.y+=d/2,t.y-=d/2):e.velX>0?(e.x-=o/2,t.x+=o/2):0>e.velX&&e.velY>0?l>s?(e.x+=s/2,t.x-=s/2):(e.y-=l/2,t.y+=l/2):0>e.velX&&0>e.velY?d>s?(e.x+=s/2,t.x-=s/2):(e.y+=d/2,t.y-=d/2):0>e.velX?(e.x+=s/2,t.x-=s/2):e.velY>0?(e.y-=l/2,t.y+=l/2):0>e.velY&&(e.y+=d/2,t.y-=d/2)})(t,e,a)}))})),(e=>{e.forEach((e=>{te.forEach((t=>{const a=ue(e,t);a.collide&&(((e,t,a)=>{const{entity1MaxX:i,entity1MaxY:n,entity2MaxX:r,entity2MaxY:h}=a,o=i-t.x,l=n-t.y,s=r-e.x,d=h-e.y;e.velX>0&&e.velY>0?l>o?e.x-=o:e.y-=l:e.velX>0&&0>e.velY?d>o?e.x-=o:e.y+=d:e.velX>0?e.x-=o:0>e.velX&&e.velY>0?l>s?e.x+=s:e.y-=l:0>e.velX&&0>e.velY?d>s?e.x+=s:e.y+=d:0>e.velX?e.x+=s:e.velY>0?e.y-=l:0>e.velY&&(e.y+=d)})(e,t,a),"bullet"===e.type&&(e.ttl=-1))}))}))})([...bullets,...enemies,E]),K.forEach(ke),j>0&&j+50>E.x?j=Math.max(0,E.x-50):V.width>j+50+140&&E.x+E.w>j+50+140&&(j=Math.min(V.width-O,E.x+E.w-190)),F>0&&F+20>E.y?F=Math.max(0,E.y-20):V.height>F+20+140&&E.y+E.h>F+20+140&&(F=Math.min(V.height-U,E.y+E.h-160)),K=K.filter((e=>!e.ttl||e.ttl>ne))}break;case 3:h("KeyT")&&(async e=>{if(navigator.canShare&&navigator.canShare(e))try{await navigator.share(e)}catch{}else open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(e.text)}&url=${encodeURIComponent(e.url)}`,"_blank")})({title:document.title,text:"I died facing fearful odds playing Stand By Me made by @herebefrogs for #js13k 2022",url:"https://bit.ly/3eBOQS6"}),(r()||R())&&fe(0)}var e,t,a})(),(()=>{let e;switch(k.clearRect(0,0,b.width,b.height),Z){case 0:W.fillStyle=ce,W.fillRect(0,0,G.width,G.height),e=me.AI.health[10],de.drawImage(ae,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),z("stand by me",120,50,1,3),z("click / press any key",120,105,1),z("proudly made in canada",120,150,1),z("jerome lecomte - js13kgames 2022",120,160,1),z("music by ryan malm",120,170,1);break;case 1:W.fillStyle=ce,W.fillRect(0,0,G.width,G.height),e=me.AI.health[10],de.drawImage(ae,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),z("i am your defense module companion!",120,50,1),z("i will stand by your side while",120,60,1),z("you protect the central core",120,70,1),z("from parasite contamination.",120,80,1),z("use wasd/ULDR to move",120,120,1),z("use your mouse to aim/fire",120,130,1),z("press any key to start",120,140,1);break;case 2:W.drawImage(V,0,0,G.width,G.height),K.forEach((e=>((e,t=W)=>{switch(t.save(),e.type){case"hero":t.translate(Math.round(e.x),Math.round(e.y)),0>e.gunAngle?(Me(),Te()):(Te(),Me());break;case"AI":t.translate(E.x+E.w/2,E.y+E.h/2),t.rotate(e.angle),t.translate(2.5*e.w,0),t.rotate(-e.angle),t.drawImage(ae,me.AI.sprite.x,me.AI.sprite.y,me.AI.sprite.w,me.AI.sprite.h,-e.w/2,-e.h/2,me.AI.sprite.w,me.AI.sprite.h);break;case"bullet":t.translate(e.x,e.y),t.rotate(e.angle+Math.PI/2),t.fillStyle="#e1e",t.fillRect(0,0,e.w,e.h);break;case"blast":t.beginPath(),t.lineWidth=e.w,t.arc(e.x,e.y,e.radius-e.w/2,0,2*Math.PI),t.strokeStyle="#1ee",t.stroke(),t.closePath();break;case"scout":case"tank":const a=e.hitPoints>0?me[e.type][e.attacking?"bite":"walk"][e.attacking?e.frameIndex1:e.frameIndex2]:me[e.type].hit;t.drawImage(e.movingRight?ae:ie,a.x,a.y,a.w,a.h,Math.round(e.x),Math.round(e.y),a.w,a.h);break;case"text":de.fillStyle=we,de.fillRect(3*C.w+5,5,O-(3*C.w+10),15),((e,t,a,i,n,r=0,h=1)=>{z(e.substring(0,Math.floor(s(0,e.length,(n-i)/500))),t,a,r,h)})(e.text,e.x,e.y,e.startTime,ne,e.align,e.scale)}t.restore()})(e))),(()=>{W.strokeStyle=we,W.lineWidth=2;const e=E.attacking?10:12,t=E.attacking?5:6;W.strokeRect(J.x-1,J.y-1,2,2),W.strokeRect(J.x-t,J.y-t,e,e)})(),(()=>{const e=me.AI.health[Math.max(0,C.hitPoints)];de.drawImage(ae,e.x,e.y,e.w,e.h,5,5,e.w,e.h)})();break;case 3:W.fillStyle=ce,W.fillRect(0,0,G.width,G.height),e=me.AI.health[0],de.drawImage(ae,e.x,e.y,e.w,e.h,120-e.w,5,2*e.w,2*e.h),z("how can one die better",120,50,1),z("than facing fearful odds",120,60,1),z("for the ashes of their ancestors",120,70,1),z("and the temples of their gods?",120,80,1),z("[t]weet",120,160,1),z("[r]estart",120,170,1)}q.drawImage(G,j,F,O,U,0,0,c.width,c.height),q.drawImage(se,0,0,O,U,0,0,c.width,c.height)})(),he=ne)}function Xe(e){(ge=e)?(he=performance.now(),Re()):cancelAnimationFrame(oe)}onload=async()=>{document.title="Stand By Me",onresize(),await(async()=>{I=await d("data:image/webp;base64,UklGRtwAAABXRUJQVlA4TNAAAAAvCAEBEA8wfQNPIGmLt/3zH+AHlG3bzr+in79tNjP9j1/727ZmW8m2jWovL+4T/FcXF5ltvhH9D/T3glZlee7h4P2XrG7pyXpT+f1vpQBO4GqQKqZMeMBmhJ454slp0xJG5tfl6H5BDR2Xp1JxjD3jmmpGcQ1oui+BiDupttiTmV+nmfJNXI5yzBxoJ3I1FwgJALAZqWdJfcLttBk8/IICn88jn1j3UamwMWfkts/gruDp62NyFZ3LDhkOx83c4p31QzawchYEXAmxQaqY4gIA")})(),ae=await d("data:image/webp;base64,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"),ie=await d("data:image/webp;base64,UklGRtwDAABXRUJQVlA4TM8DAAAvn8AfECdAJm1T/8ZKDeyeLIJsmwFNbFiXOwdBts0MZzPAK11g/gOw73emDChGslW3tlRlEtgWCYgiAKlIwOyz8s/pwt5rI/t+3zei/xAlSarbzDmR34wAwfoXtp9hvTDrkx5nm0W1RORQfM7jbDLqIjfIrKL4mMf447dXFieWPuRx7uJuD4vsInuTo8B5GKYH97rhcYove8DVZpEThdViHtcQu1Y93GN+eGVCAe3GN3nYx8HhJZ6jKH38Po9TGFdMMuwiGdaDseoR8pg0wz4ohtYwKk8PzppHiDi+ABgQAsqiR0gLvdX0+wV066mEZY+QKyYxz3d5hDwmX4TCKaHHseQRIt8lmQN+nbzJ49zDN1LMwDKsR73tEXANr8uw4Hl4nssey+BqAXg6Te9R7nq0+KvcPD8cr+I0icfzpscZ8/TDoCiY2Ao9HMTjDpX0m9ZJtZbMg5O4Bwx7uLKB9RswPYx27KFWJA2v4DyjF64t6gikdQ+YJ4DAC1hbKRECjj/UidqOu4MMoJWB2MN0nAVOA5UwRVp4YdbiRsaw4DE7wuE21ullTdKE7NMyt5hx1lVhzrFU3bYFD9MTAy0gMcd4DZNkNsL9mk+2Jrt551CcamkKLHmYA7w1eyJ5hv5MTo/TAYDIxR4eUx4mYzAZzAu8scTVdrN+BpDc+R3QgSzCcufH6Xb3oLnz08CU8Ny5yNuGoBs0L+TOcHa+smha/32QKDopOc6d5y7Xgx/3dmAVSGJf1+3TOc6d5hKn5NZE3VUYkgX26wxiiXPnLiJXAMxDiPS0xSPAvq5n80JEcjwoX5AyyDvErtpIDhG1X9cT+1iQOx0S0I8C04AUYGq7HsfABs0D8PM+Ao7GB1uKDl9MsaqYDejcX155CiQjVhX+uoxzZ/SjzO9q6nc3v8eo29/T5nzE1ULu3CV6M9yqgqjcapO8zyIlmevoTQuua8wP8TLLv5JdM4mKVBAelDB3Lp0/jS9gIoAChJOtu5WjCxivY2C0mEhFNRrtMTek8+HXXZo7FYtk6Qe+oSJZkxdJWUS6XbbOtp1t/GlBFp47tS5T1GJ+eBmRBEHuiT5A0aNAgtyJNdw0H3YHyZlq5yd9S6/PLofmIHfqLVwDdACDL+pFukgZVMrax3weX2XziPQsklms0yXIrnu/gYkYxsFTP0ue9AnuYvr3DQ0IJhCWS9VkqSWAqkED1YBa7D8tdt2VjCwslxYTT5ZImwGuAU0u4JF1RBPLJTSXIm1r1LT56wEGJuQElK5DLJfeWhBfcHPC9CtZKT0IALB9d/W///ytzAYA"),[audio,data]=(()=>{const e=new D;e.init(X);let t=0;for(;1>t;)t=e.generate(),console.log(`loaded ${100*t}%`);let a=e.createWave();return[document.createElement("audio"),URL.createObjectURL(new Blob([a],{type:"audio/wav"}))]})(),(Y=audio).src=data,Y.loop=!0,Y.volume=.15,Xe(!0)},onresize=onrotate=()=>{scaleToFit=Math.min(innerWidth/G.width,innerHeight/G.height),c.width=G.width*scaleToFit,c.height=G.height*scaleToFit,q.imageSmoothingEnabled=$.imageSmoothingEnabled=W.imageSmoothingEnabled=!1,window.focus()},document.onvisibilitychange=e=>{Xe(!e.target.hidden),e.target.hidden?P():L()},addEventListener("keydown",(e=>{e.repeat||2!==Z||"KeyP"!==e.code||Xe(!ge)}))})();</script>