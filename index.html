<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta name=monetization content=$ilp.uphold.com/2kD7NjJBDjBb><style>body{margin:0;text-align:center;background:#000}body,canvas{touch-action:none;user-select:none}</style><canvas id=c></canvas><script>(()=>{var e={},t=t=>e[t]||0,i=t=>delete e[t];addEventListener("keydown",(t=>{t.preventDefault(),t.repeat||(e[t.code]=performance.now())})),addEventListener("keyup",(e=>i(e.code)));var a=(...e)=>Math.max(...e.map((e=>t(e)))),n=()=>Object.keys(e).filter((e=>t(e))),o=()=>n().length,l=e=>!!t(e)&&i(e),h=Math.random,r=(e,t,i)=>Math.max(t,Math.min(e,i));function s(e,t,i){return 0>i?e:i>1?t:e*(1-i)+t*i}function d(e){return new Promise((t=>{var i=new Image;i.onload=()=>{t(i)},i.src=e}))}var w=0,g=0,m=0,y=0,f=0,v=0,x=0,p=0,u=0,A={pageX:0,pageY:0};addEventListener("pointerdown",(e=>{e.preventDefault(),A=e,u=performance.now(),[w,g]=[x,p]=[f,v]=P()})),addEventListener("pointermove",(e=>{e.preventDefault(),A=e,[w,g]=P(),u&&(w>x?m=s(0,1,((x=w)-f)/30):f>w?m=-s(0,1,(x-(f=w))/30):x>w&&m>=0?(f=w,m=0):w>f&&0>=m&&(x=w,m=0),g>p?y=s(0,1,((p=g)-v)/30):v>g?y=-s(0,1,(p-(v=g))/30):p>g&&y>=0?(v=g,y=0):g>v&&0>=y&&(p=g,y=0))})),addEventListener("pointerup",(e=>{e.preventDefault(),A=e,u=0,m=y=f=v=x=p=0}));var b,k,M,P=()=>[Math.floor(A.pageX),Math.floor(A.pageY)],R=()=>u,E=()=>!!R()&&(u=0,!0),I=/iPhone|iPad|Android/i.test(navigator.userAgent);function L(e,t,i,a=0,n=1){const o=5*n,l=e.length*o+(e.length-1)*n,h=2===a?l:1===a?l/2:0;[...e].forEach(((e,a)=>{M.drawImage(b,5*"abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/#[]UDLR?'=".indexOf(e),0,5,5,t+a*n*6-h,i,o,o)}))}new(window.AudioContext||webkitAudioContext);var X,D,T,S,Y,U,N=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","KeyB","KeyA"],j=0,Q=0,B=["scout","tank"],K=0,C=0,F=320,Z=240,q=100,H=c.getContext("2d"),J=c.cloneNode(),W=J.getContext("2d");J.width=640,J.height=480;var G=c.cloneNode(),O=G.getContext("2d");G.width=640,G.height=480;var z,V,$,ee,te,ie,[ae,ne]=(z=c,(k=z.cloneNode()).width=320,k.height=240,(M=k.getContext("2d")).imageSmoothingEnabled=!1,[k,M]),oe={hero:{attackRate:.1,hitPoints:100,speed:75,w:10,h:10},AI:{angle:0,hitPoints:10,speed:Math.PI,w:10,h:10},bullet:{damage:1,speed:400,ttl:1/0,w:1,h:10},blast:{speed:400,maxRadius:200,w:20},scout:{damage:2,hitPoints:1,speed:110,w:10,h:10},tank:{damage:10,hitPoints:10,speed:55,w:40,h:40},ingress:{odds:{tank:.15,scout:.85},rate:1,spawnTime:0}},le={9:"s.h.e.i.l.d. protocol activated!",8:"hey, that was weird...",7:"did you feel that too?",6:"outch, that really hurt!",5:"whats... what's happening to me?",4:"i'm scared!",3:"i don't feel so good...",2:"am i going to die?",1:"please, help me!",0:"[segfault] access violation addr=0x2022-13"},he=!0;function re(e){E(),n().forEach(l),Q=e}function se(e,t){const i={left:e.x-(t.x+t.w),right:e.x+e.w-t.x,top:e.y-(t.y+t.h),bottom:e.y+e.h-t.y,entity1MaxX:e.x+e.w,entity1MaxY:e.y+e.h,entity2MaxX:t.x+t.w,entity2MaxY:t.y+t.h};return i.collide=0>i.left&&i.right>0&&0>i.top&&i.bottom>0,i}function ce(e,t,i,a){const n=Math.sqrt(Math.pow(i-e,2)+Math.pow(a-t,2)),o=i-e,l=a-t;return[o/n,l/n,Math.atan2(l/n,o/n)]}function de(e,t=0,i=0){return{...oe[e],moveDown:0,moveLeft:0,moveRight:0,moveUp:0,velX:0,velY:0,type:e,x:t,y:i}}function we(e){if(V>e.spawnTime){let t=0;Object.entries(e.odds).find((([i,a])=>{if(t+=a,((e=0,t=1)=>h()*(t+1-e)+e)()<t)return Y.push(de(i,e.x,e.y)),e.spawnTime=V+e.rate,!0}))}}function ge(e){if(e.velX||e.velY){const t=e.speed*$*(e.velX&&e.velY?.7071067811865476:1);e.x+=t*e.velX,e.y+=t*e.velY}e.maxRadius&&(e.radius+=e.speed*$),e===D&&(e.angle+=e.speed*$,e.angle%=2*Math.PI)}function me(e){const t=e.x+e.w/2,i=e.y+e.h/2,a=X.x+X.w/2,n=X.y+X.h/2;[e.velX,e.velY,_]=ce(t,i,a,n)}function ye(e){V>e.invincibleEndTime&&(e.invincible=!1,e.hitPoints>0||(e.ttl=-1,e===X&&(X.ded=!0,ie=V+1e3))),e.radius>e.maxRadius&&(e.ttl=-1,S=0),e!==D||D.hitPoints>0||(e.ttl=-1)}function fe(){he&&(te=requestAnimationFrame(fe),V=performance.now(),$=(V-ee)/1e3,(()=>{switch(Q){case 0:l(N[j])&&j++,(o()||E())&&((e=>{h=(e=>{for(var t=0,i=2166136261;e.length>t;t++)i=Math.imul(i^e.charCodeAt(t),16777619);i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17;let a=(i+=i<<5)>>>0,n=()=>(2**31-1&(a=Math.imul(48271,a)))/2**31;return n(),n})(e);const t=new URL(location);t.searchParams.set("seed",e),history.pushState({},"",t)})("js13k2022"),j=0,K=C=0,X=de("hero",160,120),D={type:"AI",...oe.AI},U=!0,T={x:0,y:0},S=0,Y=[X,D,de("scout",F/6,5),de("scout",F/3,5),de("tank",160,10),de("scout",640/3,5),de("scout",1600/6,5),{type:"ingress",x:0,y:120,...oe.ingress}],ie=0,O.fillStyle="#edc",O.fillRect(0,0,G.width,G.height),re(1));break;case 1:if(V>ie){if(X.ded)return void re(2);[T.x,T.y]=(()=>{const[e,t]=(i=c.width,a=c.height,[r((A.x||A.pageX)-(innerWidth-i)/2,0,i),r(A.y||A.pageY,0,a)].map(Math.round));var i,a;return[e*F/c.width+K,t*Z/c.height+C].map(Math.round)})(),X.attacking=R(),X.moveLeft=a("ArrowLeft","KeyA","KeyQ"),X.moveRight=a("ArrowRight","KeyD"),X.moveUp=a("ArrowUp","KeyW","KeyZ"),X.moveDown=a("ArrowDown","KeyS"),X.velX=X.moveLeft||X.moveRight?(X.moveLeft>X.moveRight?-1:1)*s(0,1,(V-Math.max(X.moveLeft,X.moveRight))/150):0,X.velY=X.moveDown||X.moveUp?(X.moveUp>X.moveDown?-1:1)*s(0,1,(V-Math.max(X.moveUp,X.moveDown))/150):0,(()=>{const e=X.x+X.w/2,t=X.y+X.h/2,[i,a,n]=ce(e,t,T.x,T.y);if(X.gunAngle=n,X.attacking){if(X.attackTime||=X.attackRate,X.attackTime+=$,X.attackTime>X.attackRate){X.attackTime%=X.attackRate;const[o,l]=((e,t,i,a)=>[e+i*Math.cos(a),t+i*Math.sin(a)])(e,t,X.w,n);Y.unshift({...de("bullet",o,l),angle:n,velX:i,velY:a})}}else X.attackTime=0})(),ingresses=Y.filter((e=>"ingress"===e.type)),ingresses.forEach(we),Y.forEach(ge),enemies=Y.filter((e=>B.includes(e.type))),enemies.forEach(me),bullets=Y.filter((e=>"bullet"===e.type)),t=bullets,i=enemies,t.forEach((e=>{e.ttl>0&&i.find((t=>{if(!t.invincible&&se(e,t).collide)return t.hitPoints-=e.damage,t.invincible=!0,t.invincibleEndTime=V+250,e.ttl=-1,!0}))})),S&&enemies.forEach((e=>{S.radius>Math.sqrt(Math.pow(e.x+e.w/2-S.x,2)+Math.pow(e.y+e.h/2-S.y,2))&&(e.hitPoints=0,e.invincible||=!0,e.invincibleEndTime||=V+250)})),(e=>{X.invincible||e.find((e=>{if(e.hitPoints>0&&se(e,X).collide)return U&&D.hitPoints>0?(D.hitPoints-=1,(Y=Y.filter((e=>"text"!==e.type))).push({align:void 0,scale:void 0,startTime:V,text:le[D.hitPoints],ttl:V+5e3,type:"text",x:3*D.w+10,y:230})):X.hitPoints-=e.damage,X.invincible=!0,X.invincibleEndTime=V+250,ie=V+75,!S&&D.hitPoints>0&&(S={type:"blast",...oe.blast,radius:X.w,x:X.x+X.w/2,y:X.y+X.h/2},Y.unshift(S)),!0}))})(enemies);const n=[...enemies,X];n.forEach(((e,t)=>{n.slice(t+1).forEach((t=>{const i=se(e,t);i.collide&&((e,t,i)=>{const{entity1MaxX:a,entity1MaxY:n,entity2MaxX:o,entity2MaxY:l}=i,h=a-t.x,r=n-t.y,s=o-e.x,c=l-e.y;e.velX>0&&e.velY>0?r>h?(e.x-=h/2,t.x+=h/2):(e.y-=r/2,t.y+=r/2):e.velX>0&&0>e.velY?c>h?(e.x-=h/2,t.x+=h/2):(e.y+=c/2,t.y-=c/2):e.velX>0?(e.x-=h/2,t.x+=h/2):0>e.velX&&e.velY>0?r>s?(e.x+=s/2,t.x-=s/2):(e.y-=r/2,t.y+=r/2):0>e.velX&&0>e.velY?c>s?(e.x+=s/2,t.x-=s/2):(e.y+=c/2,t.y-=c/2):0>e.velX?(e.x+=s/2,t.x-=s/2):e.velY>0?(e.y-=r/2,t.y+=r/2):0>e.velY&&(e.y+=c/2,t.y-=c/2)})(e,t,i)}))})),0>(e=X).x?e.x=0:e.x>G.width-e.w&&(e.x=G.width-e.w),0>e.y?e.y=0:e.y>G.height-e.h&&(e.y=G.height-e.h),Y.forEach(ye),K>0&&K+q>X.x?K=Math.max(0,X.x-q):G.width>K+q+120&&X.x+X.w>K+q+120&&(K=Math.min(G.width-F,X.x+X.w-220)),C>0&&C+50>X.y?C=Math.max(0,X.y-50):G.height>C+50+140&&X.y+X.h>C+50+140&&(C=Math.min(G.height-Z,X.y+X.h-190)),Y=Y.filter((e=>!e.ttl||e.ttl>V))}break;case 2:l("KeyT")&&(async e=>{if(navigator.canShare&&navigator.canShare(e))try{await navigator.share(e)}catch{}else open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(e.text)}&url=${encodeURIComponent(e.url)}`,"_blank")})({title:document.title,text:"Check this game template made by @herebefrogs",url:"https://bit.ly/gmjblp"}),(o()||E())&&re(0)}var e,t,i})(),(()=>{switch(M.clearRect(0,0,k.width,k.height),Q){case 0:W.fillStyle="#edc",W.fillRect(0,0,J.width,J.height),L("title screen",5,5),L(I?"tap to start":"press any key",160,120,1),j===N.length&&L("konami mode on",J.width-5,5,2);break;case 1:W.drawImage(G,0,0,J.width,J.height),Y.forEach((e=>((e,t=W)=>{switch(t.save(),e.type){case"hero":t.translate(e.x,e.y),0>e.gunAngle?(t.save(),t.translate(e.w/2,e.h/2),t.rotate(e.gunAngle),t.translate(e.w/4,0),t.fillStyle="#ee1",t.fillRect(0,-2,10,4),t.restore(),t.fillStyle=e.hitPoints?e.invincible?"#ee1":"#1e1":"#e11",t.fillRect(0,0,e.w,e.h)):(t.fillStyle=e.hitPoints?e.invincible?"#ee1":"#1e1":"#e11",t.fillRect(0,0,e.w,e.h),t.save(),t.translate(e.w/2,e.h/2),t.rotate(e.gunAngle),t.translate(e.w/4,0),t.fillStyle="#ee1",t.fillRect(0,-2,10,4),t.restore());break;case"AI":t.translate(X.x+X.w/2,X.y+X.h/2),t.rotate(e.angle),t.translate(2.5*e.w,0),t.rotate(-e.angle),t.fillStyle="#1ee",t.fillRect(-e.w/2,-e.h/2,e.w,e.h);break;case"bullet":t.translate(e.x,e.y),t.rotate(e.angle+Math.PI/2),t.fillStyle="#e1e",t.fillRect(0,0,e.w,e.h);break;case"blast":t.beginPath(),t.lineWidth=e.w,t.arc(e.x,e.y,e.radius-e.w/2,0,2*Math.PI),t.strokeStyle="#1ee",t.stroke(),t.closePath();break;case"scout":case"tank":t.fillStyle=e.hitPoints?e.invincible?"#ee1":"#11e":"#e11",t.fillRect(e.x,e.y,e.w,e.h);break;case"text":((e,t,i,a,n,o=0,l=1)=>{L(e.substring(0,Math.floor(s(0,e.length,(n-a)/500))),t,i,o,l)})(e.text,e.x,e.y,e.startTime,V,e.align,e.scale)}t.restore()})(e))),(()=>{W.strokeStyle=X.attacking?"#f80":"#248",W.lineWidth=2;const e=X.attacking?10:12,t=X.attacking?5:6;W.strokeRect(T.x-1,T.y-1,2,2),W.strokeRect(T.x-t,T.y-t,e,e)})(),D.hitPoints>0&&(ne.fillStyle=3>D.hitPoints?"#e11":5>D.hitPoints?"#ee1":"#1ee",ne.fillRect(5,Z-3*D.h-5,3*D.w,3*D.h));break;case 2:W.fillStyle="#edc",W.fillRect(0,0,J.width,J.height),L("end screen",5,5),L("you ded",160,120,1)}H.drawImage(J,K,C,F,Z,0,0,c.width,c.height),H.drawImage(ae,0,0,F,Z,0,0,c.width,c.height)})(),ee=V)}function ve(e){(he=e)?(ee=performance.now(),fe()):cancelAnimationFrame(te)}onload=async()=>{document.title="Stand By Me",onresize(),await(async()=>{b=await d("data:image/webp;base64,UklGRtwAAABXRUJQVlA4TNAAAAAvCAEBEA8wfQNPIGmLt/3zH+AHlG3bzr+in79tNjP9j1/727ZmW8m2jWovL+4T/FcXF5ltvhH9D/T3glZlee7h4P2XrG7pyXpT+f1vpQBO4GqQKqZMeMBmhJ454slp0xJG5tfl6H5BDR2Xp1JxjD3jmmpGcQ1oui+BiDupttiTmV+nmfJNXI5yzBxoJ3I1FwgJALAZqWdJfcLttBk8/IICn88jn1j3UamwMWfkts/gruDp62NyFZ3LDhkOx83c4p31QzawchYEXAmxQaqY4gIA")})(),await d("data:image/webp;base64,UklGRvoAAABXRUJQVlA4TO0AAAAvT0AEEDegkI0kaD+kdVj40zgoxYwkQfMfg2v9l2M9lkVNACQMNCEIOPq3MIcHQbZNzcZ+sgcAlZ/5PdWeeOv2wFEjSY40hsA6AKNGsFJJ/T/DYLQIHH8MN129s4cgov8M3LaNw7a7txjZL8LDMf4r1rB0GSKbF4K5y4uBYq1A7jI7NNPSPhx6rQhN3S6ELpWd5FLH6IMjN7si35Udo6HZUgsM1NDha+wM4Efs2i4OQugUTtuccnZpNrxcDsoNs07A9qEHl7O/h4PmDm65el34+cPABatIskq6UUQaaUtaABHLKZAohglQpAV4vgkA"),ve(!0)},onresize=onrotate=()=>{scaleToFit=Math.min(innerWidth/J.width,innerHeight/J.height),c.width=J.width*scaleToFit,c.height=J.height*scaleToFit,H.imageSmoothingEnabled=O.imageSmoothingEnabled=W.imageSmoothingEnabled=!1,window.focus()},document.onvisibilitychange=e=>{ve(!e.target.hidden)},addEventListener("keydown",(e=>{e.repeat||1!==Q||"KeyP"!==e.code||ve(!he)}))})();</script>